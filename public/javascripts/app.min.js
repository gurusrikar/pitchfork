"use strict";var silverScreenApp=angular.module("silverScreen",["ui.router","ngCookies","ngAnimate","ngMaterial"]);silverScreenApp.run(function(a,b){var c=a.host().split(".");b.moviePermalink=c.length>2?c[0]:void 0}),silverScreenApp.config(function(a,b,c){c.html5Mode(!0),b.otherwise("/"),a.state("admin-home",{url:"/dashboard",templateUrl:"admin/admin-home.html",controller:"AdminHomeController"}).state("admin-update-movie",{url:"/dashboard/update-movie/:permalink",templateUrl:"admin/admin-edit-movie.html"}).state("movie-home",{url:"/",views:{movieCover:{templateUrl:"movie-cover.html",controller:"MovieHomeController"},"":{templateUrl:"movie-home.html",controller:"MoviePhotosController"}}}).state("movie-photos",{url:"/photos",templateUrl:"movie-photos.html"})}),silverScreenApp.controller("AdminHomeController",function(a,b,c,d,e,f){function g(){a.movie={},a.media={},a.permalink=f.permalink;var b=e.isAdminLoggedIn();b||c.openLoginModal(void 0,!0).then(function(a){console.log("admin logged in")})}g(),a.createNewMovie=function(){d.createMovie(a.movie).then(function(b){a.movie=b,a.active=1})},a.addPeopleToMovie=function(){d.addPeople(a.movie.permalink,a.movie.people).then(function(b){a.movie=b,a.active=2})},a.addMediaObject=function(){d.createMediaObject(a.movie.permalink,a.media).then(function(b){a.movie=b})},a.getAllMovies=function(){d.getAllMovies().then(function(b){a.movies=b})}}),silverScreenApp.controller("LoginController",function(a,b,c,d){a.signin={username:void 0,password:void 0},a.signup={name:void 0,email:void 0,username:void 0,password:void 0,admin:!1},a.login=function(){console.log(a.signin.username),console.log(a.signin.password),c.signIn(a.signin.username,a.signin.password).then(function(a){console.log("signed-In"),d.hide(!0)})},a.register=function(){var e=b.host().split("."),f=e.length>2?e[0]:void 0;"admin"===f&&(a.signup.admin=!0),c.signUp(a.signup).then(function(a){console.log("registered"),d.hide(!0)})},a.cancel=function(){console.log("Closing"),d.cancel()}}),silverScreenApp.controller("MovieHomeController",function(a,b,c,d,e,f){console.log("MovieHomeController init");var g="background-image: linear-gradient(rgba(0, 0, 0, 0.5),rgba(0, 0, 0, 0.5)),  url('",h="');";d.getMovie(b.moviePermalink).then(function(b){a.movie=b,a.movieCoverCss=g+b.mediaObject.titlePoster+h})}),silverScreenApp.controller("MoviePhotosController",function(a,b,c,d,e,f){console.log("MoviePhotosController init"),d.getMovieMedia(b.moviePermalink).then(function(b){a.media=b})}),silverScreenApp.directive("movieEditor",function(){return{restrict:"E",templateUrl:"directives/movie-editor.html",scope:{permalink:"=permalink"},controller:function(a,b,c,d,e){a.movie={},a.media={},a.selectedIndex=0,a.editing=!1,void 0===a.permalink&&void 0===e.permalink||d.getMovie(e.permalink).then(function(b){a.movie=b,a.media=b.mediaObject||{},a.editing=!0}),a.createNewMovie=function(){d.createMovie(a.movie).then(function(b){a.movie=b,a.selectedIndex=1})},a.updateMovie=function(){d.updateMovie(e.permalink,a.movie).then(function(b){a.movie=b,a.selectedIndex=1})},a.addPeopleToMovie=function(){d.addPeople(a.movie.permalink,a.movie.people).then(function(b){a.movie=b,a.selectedIndex=2})},a.addMediaObject=function(){d.createMediaObject(a.movie.permalink,a.media).then(function(b){a.movie=b})},a.updateMediaObject=function(){d.updateMediaObject(a.movie.permalink,a.media).then(function(b){a.movie.media=b})}}}}),silverScreenApp.directive("reelBar",function(){return{restrict:"E",templateUrl:"directives/navbar.html",controller:function(a,b,c,d,e){var f=e.host().split("."),g=f.length>2?f[0]:void 0;a.moviePermalink=g,a.openLoginModal=function(b,c){d.openLoginModal(b,c).then(function(b){a.loggedIn=b},function(){console.info("User logged in at "+new Date)})},a.isSignedIn=function(){return c.isLoggedIn()},a.logout=function(){return b.signOut().then(function(a){e.path("/")})}}}}),silverScreenApp.factory("HttpService",function(a,b){var c="/api",d=function(a,b){return f("GET",a,void 0,b,void 0)},e=function(a,b,c){return f("POST",a,b,c,void 0)},f=function(a,d,e,f,g){var h=void 0!=e&&typeof e===String;return b({method:a,url:c+d,data:void 0==e?void 0:h?e:$.param(e),params:f,timeout:void 0===g?3e4:g,headers:{"Content-Type":h?"application/json":"application/x-www-form-urlencoded"}}).then(function(b){return console.log("success "+a+" "+c+d),console.log(b.data),b.data},function(b){return console.log("error "+a+" "+c+d),console.log(b),b})};return{get:d,post:e}}),silverScreenApp.factory("ModalService",function(a){function b(b,c){return console.log("Clicked openLoginModal"),a.show({controller:"LoginController",templateUrl:"modals/modal-login.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:c!==!0})}return{openLoginModal:b}}),silverScreenApp.factory("MovieService",function(a){var b="/movie",c="/media",d=function(c){return a.post(b+"/create-movie",void 0,c).then(function(a){return a})},e=function(c,d){return a.post(b+"/"+c+"/update-movie",void 0,d).then(function(a){return a})},f=function(c,d){return a.post(b+"/"+c+"/update-people",void 0,d).then(function(a){return a})},g=function(b,d){return a.post(c+"/"+b+"/create-media",void 0,d).then(function(a){return a})},h=function(b,d){return a.post(c+"/"+b+"/update-media",void 0,d).then(function(a){return a})},i=function(){return a.get(b+"/all",void 0,void 0).then(function(a){return a})},j=function(c){return a.get(b+"/"+c,void 0,void 0).then(function(a){return a})},k=function(b){return a.get(c+"/"+b,void 0,void 0).then(function(a){return a})};return{createMovie:d,updateMovie:e,addPeople:f,createMediaObject:g,updateMediaObject:h,getAllMovies:i,getMovie:j,getMovieMedia:k}}),silverScreenApp.factory("ScreenState",function(a,b,c){function d(a){b.authenticatedUser=a,c.put("fan",a._id,{maxAge:9e5}),c.put("fanInfo",JSON.stringify(a),{maxAge:9e5}),b.signedIn=!0}function e(){b.authenticatedUser=void 0,c.remove("fan"),c.remove("fanInfo"),b.signedIn=!1}function f(){return void 0!=c.get("fan")}function g(){return void 0!=c.get("fan")&&JSON.parse(c.get("fanInfo")).admin}return console.log("ScreenState init"),{setAuthenticatedUser:d,clearAuthenticatedUser:e,isLoggedIn:f,isAdminLoggedIn:g}}),silverScreenApp.factory("UserService",function(a,b){var c="/user",d=function(d,e,f){return a.post(c+"/sign-in",{username:d,password:e}).then(function(a){return b.setAuthenticatedUser(a),a})},e=function(d,e){return a.post(c+"/sign-up",{name:d.name,email:d.email,username:d.username,password:d.password}).then(function(a){return b.setAuthenticatedUser(a),a})},f=function(){return a.post(c+"/sign-out").then(function(a){return b.clearAuthenticatedUser(),a})};return{signIn:d,signUp:e,signOut:f}});